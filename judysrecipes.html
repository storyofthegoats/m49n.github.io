<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Judy Maupin's Recipe Book · m49n</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 40px 20px;
        font-family: "JetBrains Mono", ui-monospace, Menlo, Monaco, Consolas,
          "Courier New", monospace;
        background: #050505;
        color: #e5e5e5;
      }

      main {
        max-width: 960px;
        margin: 0 auto;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      .top-link {
        font-size: 0.8rem;
        color: #777;
        margin-bottom: 12px;
        display: inline-block;
      }

      .title {
        font-size: 1.3rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      .subtitle {
        font-size: 0.9rem;
        color: #9ad6ff;
        margin-bottom: 18px;
        line-height: 1.5;
      }

      .divider {
        border: none;
        border-top: 1px solid #222;
        margin: 0 0 24px 0;
      }

      .section-label {
        font-size: 0.8rem;
        color: #777;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        margin-bottom: 10px;
      }

      .panel {
        border: 1px solid #151515;
        background: radial-gradient(circle at top left, #0e0e0e 0, #050505 70%);
        border-radius: 12px;
        padding: 16px 14px;
        margin-bottom: 18px;
      }

      .panel + .panel {
        margin-top: 12px;
      }

      .panel-title {
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        margin: 0 0 8px 0;
        color: #cfcfcf;
      }

      .panel-note {
        font-size: 0.85rem;
        color: #9ad6ff;
        margin: 0 0 12px 0;
        line-height: 1.45;
      }

      .search-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 12px;
      }

      .category-pill-row {
        display: grid;
        gap: 6px;
        margin: 8px 0 14px 0;
      }

      .pill-header {
        display: flex;
        align-items: baseline;
        gap: 10px;
        flex-wrap: wrap;
      }

      .category-pills {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 0;
        padding: 0;
        list-style: none;
      }

      .category-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid #1f1f1f;
        background: #0a0a0a;
        color: #9ad6ff;
        cursor: pointer;
        font-size: 0.85rem;
        font-family: inherit;
        letter-spacing: 0.05em;
        transition: border-color 0.2s ease, transform 0.2s ease, background 0.2s ease;
      }

      .category-pill:hover {
        border-color: #4af626;
        transform: translateY(-1px);
      }

      .category-pill.active {
        border-color: #4af626;
        background: radial-gradient(circle at top left, #0f2a10 0, #0a0f0a 70%);
        color: #c9ffd0;
      }

      .category-count {
        font-size: 0.75rem;
        color: #7bc06f;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid #1f1f1f;
        background: #0f0f0f;
      }

      .search-input {
        flex: 1;
        min-width: 240px;
        padding: 8px 10px;
        font-size: 0.9rem;
        border-radius: 8px;
        border: 1px solid #333;
        background: #050505;
        color: #e5e5e5;
      }

      .search-input:focus {
        outline: none;
        border-color: #4af626;
      }

      .button {
        padding: 8px 12px;
        font-size: 0.85rem;
        font-family: inherit;
        border-radius: 8px;
        border: 1px solid #333;
        background: #0d0d0d;
        color: #e5e5e5;
        cursor: pointer;
        transition: border-color 0.2s ease, transform 0.2s ease;
      }

      .button:hover {
        border-color: #4af626;
        transform: translateY(-1px);
      }

      .button.secondary {
        background: #0a0a0a;
        color: #9ad6ff;
      }

      .results-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 10px;
      }

      .result-card {
        border: 1px solid #151515;
        border-radius: 10px;
        padding: 12px;
        background: radial-gradient(circle at top left, #101010 0, #050505 70%);
        display: grid;
        gap: 6px;
      }

      .result-title {
        font-size: 1rem;
        color: #e5e5e5;
        margin: 0;
      }

      .result-meta {
        font-size: 0.85rem;
        color: #8dd7ff;
      }

      .result-ingredients {
        font-size: 0.85rem;
        color: #b8b8b8;
        line-height: 1.5;
      }

      .result-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .back-to-top-row {
        display: flex;
        justify-content: flex-end;
        margin: 18px 0 6px;
      }

      .back-to-top {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid #1f1f1f;
        background: #0a0a0a;
        color: #9ad6ff;
        font-size: 0.85rem;
        font-family: inherit;
        cursor: pointer;
        letter-spacing: 0.04em;
        transition: border-color 0.2s ease, transform 0.2s ease, background 0.2s ease, color 0.2s ease;
      }

      .back-to-top:hover {
        border-color: #4af626;
        color: #c9ffd0;
        transform: translateY(-1px);
        background: radial-gradient(circle at top left, #0f2a10 0, #0a0f0a 70%);
      }

      .recipe-view {
        border: 1px solid #1a1a1a;
        background: radial-gradient(circle at top left, #0d0d0d 0, #040404 75%);
        border-radius: 12px;
        padding: 16px 14px;
      }

      .recipe-name {
        font-size: 1.05rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin: 0 0 8px 0;
      }

      .recipe-section {
        margin: 0 0 12px 0;
      }

      .recipe-section strong {
        display: block;
        margin-bottom: 4px;
        color: #9ad6ff;
        letter-spacing: 0.08em;
        font-size: 0.85rem;
      }

      .recipe-body {
        margin: 0;
        white-space: pre-line;
        line-height: 1.6;
      }

      .status-text {
        font-size: 0.85rem;
        color: #888;
        margin: 8px 0 0 0;
      }

      .footer {
        font-size: 0.75rem;
        color: #666;
        margin-top: 24px;
      }

      @media (max-width: 700px) {
        body {
          padding: 28px 16px;
        }

        .search-row {
          flex-direction: column;
          align-items: stretch;
        }

        .search-input {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <main>
      <header>
        <div class="title">This is Judy's Recipe</div>
        <div class="subtitle">
          A comprehensive collection of Judy Maupin's recipes as originally maintained by her in the AZZ card saver system, and saved by Gib from computer to computer. Browse categories, search by name or ingredient,
          or pull a random "Recipe of the Day" to cook something new (but probably familiar).
        </div>
        <hr class="divider" />
      </header>

      <section class="panel">
        <div class="panel-title">Search &amp; discover</div>
        <p class="panel-note">
          Search by recipe name or ingredient. Click view under any receipe to pull up the complete version.
        </p>
        <div class="search-row">
          <input
            id="searchInput"
            class="search-input"
            type="search"
            placeholder="Search recipe name or ingredient"
            aria-label="Search recipe name or ingredient"
          />
          <div class="result-actions">
            <button class="button" id="randomButton" type="button">Recipe of the Day</button>
            <button class="button secondary" id="clearButton" type="button">Clear search</button>
          </div>
        </div>
        <div class="category-pill-row">
          <div class="pill-header">
            <div class="section-label">Categories</div>
            <div class="status-text" id="categoryStatus">Loading categories…</div>
          </div>
          <div class="category-pills" id="categoryList" role="list"></div>
        </div>
        <ul class="results-list" id="results"></ul>
        <div class="status-text" id="resultsStatus">Waiting for recipes…</div>
      </section>

      <section class="recipe-view" id="recipeView" aria-live="polite">
        <div class="recipe-name" id="recipeName">Pick a recipe to view.</div>
        <div class="recipe-section">
          <strong>Ingredients</strong>
          <p class="recipe-body" id="recipeIngredients">—</p>
        </div>
        <div class="recipe-section">
          <strong>Method</strong>
          <p class="recipe-body" id="recipeMethod">—</p>
        </div>
        <div class="recipe-section" id="recipeNotesSection">
          <strong>Family Notes</strong>
          <p class="recipe-body" id="recipeNotes">—</p>
        </div>
      </section>

      <div class="back-to-top-row">
        <button class="back-to-top" id="backToTop" type="button" aria-label="Back to top">
          ↑ Back to top
        </button>
      </div>

      <div class="footer">© 2025</div>
    </main>

    <script>
      const sheetUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT4v9TckwxuT-7uavMOVXogmFkjfC_Jo-cqmYUXu1re0zJXnuSZZnFiUyW_92U3DDkeE0w8e5P2SHl9/pub?output=csv";

      const categoryList = document.getElementById("categoryList");
      const categoryStatus = document.getElementById("categoryStatus");
      const searchInput = document.getElementById("searchInput");
      const resultsList = document.getElementById("results");
      const resultsStatus = document.getElementById("resultsStatus");
      const recipeView = document.getElementById("recipeView");
      const recipeNameEl = document.getElementById("recipeName");
      const recipeIngredientsEl = document.getElementById("recipeIngredients");
      const recipeMethodEl = document.getElementById("recipeMethod");
      const recipeNotesSection = document.getElementById("recipeNotesSection");
      const recipeNotesEl = document.getElementById("recipeNotes");
      const randomButton = document.getElementById("randomButton");
      const clearButton = document.getElementById("clearButton");
      const backToTopButton = document.getElementById("backToTop");

      let recipes = [];
      let selectedCategory = null;
      let currentRecipe = null;

      function escapeHTML(value) {
        return (value || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function parseCSV(text) {
        const rows = [];
        let current = "";
        let inQuotes = false;
        let row = [];

        for (let i = 0; i < text.length; i++) {
          const char = text[i];
          const next = text[i + 1];

          if (char === "\"" && inQuotes && next === "\"") {
            current += "\"";
            i++;
            continue;
          }

          if (char === "\"") {
            inQuotes = !inQuotes;
            continue;
          }

          if ((char === "\n" || char === "\r") && !inQuotes) {
            if (current !== "" || row.length) {
              row.push(current);
              rows.push(row);
              row = [];
              current = "";
            }
            continue;
          }

          if (char === "," && !inQuotes) {
            row.push(current);
            current = "";
            continue;
          }

          current += char;
        }

        if (current !== "" || row.length) {
          row.push(current);
          rows.push(row);
        }

        return rows;
      }

      function normalizeRows(rawRows) {
        if (!rawRows.length) return [];

        const header = rawRows[0].map((cell) => cell.trim().toLowerCase());
        const hasHeader = header.includes("category") || header.includes("recipe") || header.includes("ingredients");
        const rows = hasHeader ? rawRows.slice(1) : rawRows;

        return rows
          .map((row) => {
            const [category = "", , name = "", ingredients = "", method = "", familyNotes = ""] = row;
            return {
              category: category.trim(),
              name: name.trim(),
              ingredients: ingredients.trim(),
              method: method.trim(),
              familyNotes: familyNotes.trim(),
            };
          })
          .filter((entry) => entry.name || entry.ingredients || entry.category);
      }

      function renderCategories(list) {
        categoryList.innerHTML = "";
        if (!list.length) {
          categoryStatus.textContent = "No categories found.";
          return;
        }

        list.forEach((entry) => {
          const { label, items } = entry;
          const button = document.createElement("button");
          button.type = "button";
          button.className = "category-pill";
          button.setAttribute("data-label", label || "Uncategorized");

          const text = document.createElement("span");
          text.textContent = label || "Uncategorized";

          const count = document.createElement("span");
          count.className = "category-count";
          count.textContent = `${items.length}`;

          button.appendChild(text);
          button.appendChild(count);

          button.addEventListener("click", () => {
            toggleCategory(label || "Uncategorized");
          });

          categoryList.appendChild(button);
        });

        categoryStatus.textContent = "Tap a pill to filter recipes.";
        updateCategorySelectionUI();
      }

      function renderResults(list) {
        resultsList.innerHTML = "";

        if (!list.length) {
          resultsStatus.textContent = "No recipes match those filters yet.";
          return;
        }

        list.forEach((recipe) => {
          const li = document.createElement("li");
          li.className = "result-card";

          const title = document.createElement("div");
          title.className = "result-title";
          title.textContent = recipe.name || "Untitled recipe";

          const meta = document.createElement("div");
          meta.className = "result-meta";
          meta.textContent = recipe.category || "Uncategorized";

          const ing = document.createElement("div");
          ing.className = "result-ingredients";
          ing.textContent = recipe.ingredients || "No ingredients listed yet.";

          const actions = document.createElement("div");
          actions.className = "result-actions";

          const viewBtn = document.createElement("button");
          viewBtn.type = "button";
          viewBtn.className = "button";
          viewBtn.textContent = "View";
          viewBtn.addEventListener("click", () => showRecipe(recipe));

          actions.appendChild(viewBtn);

          li.appendChild(title);
          li.appendChild(meta);
          li.appendChild(ing);
          li.appendChild(actions);
          resultsList.appendChild(li);
        });

        resultsStatus.textContent = `${list.length} recipe${list.length === 1 ? "" : "s"} ready.`;
      }

      function showRecipe(recipe) {
        currentRecipe = recipe;
        recipeNameEl.textContent = recipe.name || "Untitled recipe";
        recipeIngredientsEl.textContent = recipe.ingredients || "No ingredients listed.";
        recipeMethodEl.textContent = recipe.method || "No method provided yet.";

        if (recipeNotesSection && recipeNotesEl) {
          const hasNotes = recipe.familyNotes?.trim();
          if (hasNotes) {
            recipeNotesEl.textContent = recipe.familyNotes;
            recipeNotesSection.style.display = "block";
          } else {
            recipeNotesEl.textContent = "";
            recipeNotesSection.style.display = "none";
          }
        }

        if (recipeView) {
          recipeView.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }

      function getCategoryLabel(recipe) {
        return recipe.category?.trim() || "Uncategorized";
      }

      function toggleCategory(label) {
        selectedCategory = selectedCategory === label ? null : label;
        updateCategorySelectionUI();
        updateResults();
      }

      function updateCategorySelectionUI() {
        const buttons = categoryList.querySelectorAll(".category-pill");
        buttons.forEach((button) => {
          const label = button.getAttribute("data-label");
          if (label === selectedCategory) {
            button.classList.add("active");
          } else {
            button.classList.remove("active");
          }
        });

        categoryStatus.textContent = selectedCategory
          ? `Showing ${selectedCategory} recipes.`
          : "Select a category pill to show recipes.";
      }

      function getFilteredRecipes() {
        const query = searchInput.value.trim().toLowerCase();
        let filtered = recipes;

        if (selectedCategory && selectedCategory !== "All") {
          filtered = filtered.filter((recipe) => getCategoryLabel(recipe) === selectedCategory);
        }

        if (query) {
          filtered = filtered.filter((recipe) => {
            const name = recipe.name.toLowerCase();
            const ingredients = recipe.ingredients.toLowerCase();
            return name.includes(query) || ingredients.includes(query);
          });
        }

        return filtered;
      }

      function updateResults() {
        const query = searchInput.value.trim();
        if (!query && !selectedCategory) {
          resultsList.innerHTML = "";
          resultsStatus.textContent = recipes.length
            ? "Select a category pill or search to see recipes."
            : "Waiting for recipes…";
          return;
        }

        const filtered = getFilteredRecipes().slice(0, 50);
        renderResults(filtered);
      }

      async function load() {
        categoryStatus.textContent = "Loading categories…";
        resultsStatus.textContent = "Fetching recipes…";
        try {
          const response = await fetch(sheetUrl);
          const text = await response.text();
          const rows = parseCSV(text);
          recipes = normalizeRows(rows);

          const categoryMap = new Map();
          recipes.forEach((recipe) => {
            const label = getCategoryLabel(recipe);
            if (!categoryMap.has(label)) {
              categoryMap.set(label, []);
            }
            categoryMap.get(label).push(recipe);
          });

          const categoryEntries = Array.from(categoryMap.entries())
            .map(([label, items]) => ({ label, items }))
            .sort((a, b) => a.label.localeCompare(b.label));

          categoryEntries.unshift({ label: "All", items: recipes });

          selectedCategory = "All";

          renderCategories(categoryEntries);
          updateResults();
        } catch (error) {
          categoryStatus.textContent = "Couldn't load the sheet right now. Try again soon.";
          resultsStatus.textContent = "Search is paused until the sheet loads.";
        }
      }

      searchInput.addEventListener("input", () => {
        updateResults();
      });

      randomButton.addEventListener("click", () => {
        const filtered = getFilteredRecipes();
        const pool = filtered.length ? filtered : recipes;
        if (!pool.length) return;
        const randomIndex = Math.floor(Math.random() * pool.length);
        const recipe = pool[randomIndex];
        showRecipe(recipe);
        resultsStatus.textContent = `Recipe of the Day: ${recipe.name || "Untitled recipe"}`;
      });

      clearButton.addEventListener("click", () => {
        searchInput.value = "";
        resultsStatus.textContent = recipes.length
          ? "Cleared search. Pick a category pill or start typing to browse."
          : "Waiting for recipes…";
        updateResults();
      });

      if (backToTopButton) {
        backToTopButton.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }

      if (recipeNotesSection) {
        recipeNotesSection.style.display = "none";
      }

      load();
    </script>
  </body>
</html>
